---
title: "HW2: ANOVA"
author: "MATH/STAT 571A"
date: "**DUE: 2/16/2024 11:59pm**"
header-includes:
   - \renewcommand*\familydefault{\sfdefault} %% this picks a sans serif font
   - \usepackage[T1]{fontenc}
output: pdf_document
---

```{r setup, echo=F}
knitr::opts_chunk$set(cache = T, fig.width = 8, fig.height = 5, fig.align = 'center')
```

## Homework Guidelines

***Please submit your answers on Gradescope as a PDF with pages matched to question answers.***

One way to prepare your solutions to this homework is with R Markdown, which provides a way to include mathematical notation, text, code, and figures in a single document. A template `.Rmd` file is available through D2L. 

Make sure all solutions are clearly labeled, and please utilize the question pairing tool on Gradescope. You are encouraged to work together, but your solutions, code, plots, and wording should always be your own. Come and see me during office hours or schedule an appointment when you get stuck and can't get unstuck.

### I. Mathematical Foundations [11 pts]

(@) [6 pts] Create a synthetic data set with $n = 3$ replicates for each of $a = 3$ groups such that the overall $F$-test rejects $H_0: \mu_1 = \mu_2 = \mu_3$ at the $\alpha = 0.05$ level, but all three pairwise $t$-tests of the form $H_0: \mu_i = \mu_{i'}, i \neq i'$ have p-values greater than 0.05.

There needs to be enough variation among the groups, but not as much comparing pairs. The sample size should also be big enough to capture the variation without being too big that it finds differences in the pairs.

```{r}
set.seed(1234)
n = 20
data <- data.frame(
  group = rep(c("A", "B", "C"), each = n),
  value = c(rnorm(n, 10,2),
            rnorm(n, 12,2),
            rnorm(n, 10.5,2))
)

# Perform ANOVA
anova_result <- aov(value ~ group, data = data)
summary(anova_result)

# Perform pairwise comparisons
pairwise_result <- pairwise.t.test(data$value, data$group, p.adjust.method = 'bonferroni')
pairwise_result
```

(@) [5 pts] (DAE 3.37) Show that the variance of the linear combination $\sum_{i = 1}^a c_i y_{i.}$, where $y_{i.} = \sum_{j = 1}^{n_i} y_{ij}$, is $\sigma^2\sum_{i=1}^a n_i c_i^2$. **proof at the end of document**

### II. Applications [29 pts]

(@) [5 pts] (DAE 3.4) *See text. You can also use R to obtain an exact (up to rounding error) p-value.*
The p-value is 1.18*10-9.
```{r}
ss_e <- 186.53
df_e <- 25

ss_f <- 1174.24-186.53
df_f <- 4

ms_e <- ss_e/df_e
ms_f <- ss_f/df_f
f <- ms_f/ms_e

pf(f, df_f, df_e, lower.tail = F)
```

(@) [6 pts] (DAE 3.24) *See text.*

    (a) [2 pts] By Tukey's honest significant difference test, there is  evidence that some groups are different. The p-values for some groups are lower than the 0.05 threshold.
    (b) [2 pts] The residuals v. fitted and qqplots show that the data has homoskedastic and normal residuals which satisfy the model assumptions. The independence of groups assumption is also met with Levene's test.
    (c) [2 pts] The lowest noise circuit would be either circuit 1 or 3 since there is not much of a difference between their means by the Tukey HSD test.
```{r}
circuits <- data.frame(
  design = rep(1:4, each = 5),
  noise = c(19, 20, 19, 30, 
            8, 80, 61, 73, 
            56, 80, 47, 26, 
            25, 35, 50, 95,
            46, 83, 78, 97)
)
circuits_aov <- aov(noise ~ as.factor(design), data = circuits)
circuits_hsd <- TukeyHSD(circuits_aov,
                   conf.level=0.95)
circuits_hsd # there is evidence that some groups are different
means <- aggregate(noise ~ as.factor(design), data = circuits, FUN = mean)
means

# Model assumptions for residuals
## 1. Normality
qqnorm(resid(circuits_aov))
qqline(resid(circuits_aov))

## 2. Constant variance
plot(circuits_aov, which = 1)
plot(circuits$design, resid(circuits_aov))

library(car)
leveneTest(noise ~ as.factor(design), data = circuits)
```

(@) [4 pts] (DAE 3.39) Use Bartlett's test to determine if the assumption of equal variances is satisﬁed in Problem 3.24. Use $\alpha = 0.05$. Did you reach the same conclusion regarding equality of variances by examining residual plots? (*Hint: you can use `bartlett.test()` in R*.)

With a p-value of .297, the test does not pass the threshold of .05. Therefore, this suggests equality of variances similar to the residual plots.

```{r}
bartlett.test(noise ~ as.factor(design), data = circuits)
```

(@) [6 pts] (DAE 3.28) *See text. Data are on D2L as a CSV file.*

    (a) [2 pts] Some of the materials are different.
```{r}
material <- data.frame(
  material = rep(1:5, each = 4),
  failure_times = c(110,157,194, 178,
                    1,2,4,18,
                    880,1256,5276,4355,
                    495,7040,5307,10050,
                    7,5,29,2)
)
material

materials_aov <- aov(failure_times ~ as.factor(material), data = material)
materials_hsd <- TukeyHSD(materials_aov, 
                          conf.level = 0.95)
materials_hsd
```
    (b) [2 pts] The data appear to be heteroskedastic in the residuals v. fitted plot. They also appear to be nonnormal based on the qq plot.
```{r}
plot(materials_aov, which = 1)
qqnorm(resid(materials_aov))
qqline(resid(materials_aov))

### It appears that residuals are not normally distributed and heteroskedastic
```
    (c) [2 pts] The log transform on the failure times allowed the residuals to become more normal and homoskedastic. Based on Tukey's HSD, there are some different groups: 4-1, 4-2, and 5-4 appear to be differently grouped pairs.
```{r}
material$logft <- log(material$failure_times)
material

materials_transform_aov <- aov(logft ~ as.factor(material), data = material)
plot(materials_transform_aov, which = 1)
plot(material$material, resid(materials_transform_aov))
qqnorm(resid(materials_transform_aov))
qqline(resid(materials_transform_aov))

materials_hsd <- TukeyHSD(materials_aov, 
                          conf.level = 0.95)
materials_hsd
```
    
(@) [8 pts] (DAE 2.46) Consider the experiment described in Problem 2.26. 
    (a) [4 pts] If the mean burning times of the two ﬂares differ by as much as 2 minutes, ﬁnd the power of the test. **The power is 0.9004278**
    (b) [4 pts] What sample size would be required to detect an actual difference in mean burning time of 1 minute with a power of at least 0.90? **The sample size would be 458**

```{r}
power.anova.test(groups = 2,
                 n = 458,
                 between.var = 2,
                 within.var = 9.32^2,
                 sig.level = 0.05)

power.anova.test(groups = 2,
                 between.var = 2,
                 within.var = 9.32^2, 
                 power = .90,
                 sig.level = 0.05)
```
